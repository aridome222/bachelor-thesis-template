\chapter{おわりに}\label{cha:Conclusion}
本研究では、レイアウトの不具合箇所の発見にかかる時間の削減を目的として、
レイアウトの不具合箇所を強調表示する視覚的回帰テストツール\toolName(Mix Visual Regression Testing)を試作した。
\par
\toolName は、以下の3つを強調表示する機能を持つ。
\begin{itemize}
      \item 差分箇所:\\
            変更前後のWebページの画像を比較して、変更前のWebページから削除された範囲と、
            変更後のWebページに追加された範囲。
      \item 変更箇所:\\
            変更前後のWebページのHTMLコードを比較して、HTMLコードにおけるbody要素内の変更とstyle要素内の変更のどちらか、
            または両方が適用された画面要素の範囲。
            本研究では、変更箇所を意図的なレイアウトの差分の範囲とみなす。
      \item レイアウトの不具合箇所:\\
            差分箇所から、意図的なレイアウトの差分の範囲であるHTMLコードの変更箇所を除いた、
            レイアウトの不具合の範囲。
\end{itemize}
\par
以下の4つのケースに対して、\toolName を用いて検証することで、画像比較に基づく差分箇所からHTMLコードに基づかないレイアウトの不具合箇所を強調表示できることを確認した。
\begin{itemize}
      \item 画像比較に基づく差分箇所表示通りに画面要素が削除されている
      \item 画像比較に基づく差分箇所表示通りに画面要素が削除されていない
      \item 画像比較に基づく差分箇所表示通りに画面要素が追加されている
      \item 画像比較に基づく差分箇所表示通りに画面要素が追加されていない
\end{itemize}
% 【下記は2章に書く】\\
% 画像比較に基づく差分箇所には、意図したレイアウトの変更と意図しないレイアウトの変更がある。
% 意図したレイアウトの変更はHTMLコードに基づいており、意図しないレイアウトの変更はHTMLコードに基づいていない。
% なお、本研究では、意図しないレイアウトの変更箇所を、「レイアウトの不具合箇所」と定義する。
\par
また、評価実験として、
\toolName を使用した場合と、
従来の画像ベースの視覚的回帰テストで生成する差分画像を使用する場合とで、レイアウトの不具合箇所の発見にかかる時間を、それぞれ計測した。
評価実験の結果、レイアウトの不具合箇所を発見するのにかかる時間を、
\toolName は、従来手法と比べて、レイアウトの不具合箇所の発見時間を、
Webページ1つあたり平均で12分22秒(90.6\%)削減することができた。
さらに、\toolName は、すべてのレイアウトの不具合箇所を過不足なく検出できた。
一方、従来手法では、レイアウトの不具合箇所を過剰に検出することや、検出が不足することがあった。
この結果から、\toolName は、従来の画像ベースの視覚的回帰テストと比較して、
レイアウトの不具合箇所の発見に有用であることを確認した。
\par
以上のことから、本研究で試作した \toolName は、
レイアウトの不具合箇所の発見にかかる時間の削減に有用であるといえる。
\par
以下に、\toolName の今後の課題を示す。
\begin{itemize}
      \item 画像サイズの差に対する閾値の設定:\\
            テスト対象とする変更前後のWebページの画面サイズが同じでないと、
            視覚的回帰テストを行うことができない。変更前後のWebページの画面サイズが異なる場合は、画面サイズの差に閾値を設定することで、
            その閾値以内なら、画像の調整や比較方法を動的に変更できるようにする必要がある。
      \item 画像比較の回数に対する拡張:\\
            現在の\toolName では、一度の実行で1回しかテストできない。このため、多くのWebページをテストする必要があるWebサイトに有用性があると言えない。
            テスト対象とするWebページだけでなく、サイト内の全てのWebページに対しても、視覚的回帰テストを行えるようにしなければ、
            実用的だと言えない。解決策として、Seleniumによるスクレイピング技術を用いたり、開発リポジトリをクローンしておくだけでそのリポジトリにおける開発Webページに対して、
            視覚的回帰テストを自動で実行できる機能を実装する必要がある。
      \item 白地以外の背景画像に対応する拡張:\\
            背景が白地でなく、赤色や緑色であったりした場合に、適切に変更箇所に色付きの枠を付けることができない。
            現在の\toolName では、HTMLの変更箇所に赤枠や緑枠をつけて強調表示したり、画像比較で生成した差分画像に赤枠や緑枠をつけて強調表示したりしている。
            このため、
            テスト対象とするWebページの背景が白地でなく、赤や緑など強調する色付きの枠と同じであると、適切に画像を強調することができない。
            解決策として、そのようなWebページは視覚的回帰テストの対象としない処理にするか、背景の色や画像内に多く含む色を検出し、その色と区別できる色で変更箇所を強調表示する必要があると考える。
      \item HTMLコード解析方法の変更による拡張:\\
            現在の\toolName では、HTML構造が一定の形式に沿っていないと適切にHTMLを解析することができず、開発者の意図した変更箇所を適切に囲まない枠付きHTMLコードを生成してしまう。
            この解決策として、HTMLコードの解析をテキストベースで行うのではなく、DOM解析やより高度な解析技術を用いて、HTMLコードの解析が必要となる。
      \item HTMLコード以外のファイル取得による拡張:\\
            画像取得部によるHTMLコードの取得では、取得するHTMLコードのCSSやJavaScriptが別ファイルで記述されていると、そのファイルを読み込むことができず、適切な枠付きHTMLコードを生成できない。解決策として、
            単一のHTMLコードだけでなく、そのHTMLに用いるCSSやJavascriptのファイルも取得できるようにする必要がある。
      \item レイアウトの不具合箇所の検出アルゴリズムの拡張:\\
            現在の\toolName では、親子関係にある画面要素間に重なりが発生しても、その箇所をレイアウトの不具合箇所として強調表示することができない。
            これが起こる原因は、レイアウトの不具合箇所を検出する際に、
            差分箇所に付ける枠と変更箇所に付ける枠の重なりを比較し、重なりの面積が小さい方の面積の5割以上の場合に、それらの枠を意図的な差分と判定する。
            親子関係にある画面要素は、親要素が子要素を完全に内包していることが多いため、これらをレイアウトの不具合箇所として検出できない。
            解決策として、画像内にある枠の構造化を行い、親要素が子要素を完全に内容している場合は、別途処理を行う必要がある。
\end{itemize}

% \par
% 初期設定を行った状態でテスト対象とするWebページのURLを入力として受け取ることで、
% 以下に示す、\toolName による生成した画像を、Flaskを用いて構築したローカルサーバ上で動作するWebページに、
% 出力し、表示する。
% \begin{itemize}
%     \item Webページの変更前画像と変更後画像
%     \item 画像比較に基づく差分箇所を、色付きの枠で囲むことで強調表示した、Webページの変更前画像と変更後画像
%     \item HTMLコードの変更に基づく影響箇所を、色付きの枠で囲むことで強調表示した、Webページの変更前画像と変更後画像
%     \item レイアウトの不具合箇所を、色付きの枠で囲むことで強調表示した、Webページの変更前画像と変更後画像
% \end{itemize}
% % \par
% 【TODO: ツールの機能の詳細な説明】

% 【TODO: 適用例で確認したこと】

% 【TODO: 実験で分かったこと】

% 【TODO: 今後の課題】



