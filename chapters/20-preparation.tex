\chapter{研究の準備}\label{cha:Preparation}

\section{視覚的回帰テスト}\label{sec:vrt}
視覚的回帰テスト (Visual regression testing)\cite{Visual regression testing}は、
Webページの変更前画像と変更後画像を比較し差分を検出することで、意図しないレイアウトの変更が発生していないことを確認するテスト手法である。
視覚的回帰テストの基本的な手順は以下の通りである。
\begin{enumerate}
    \setlength{\itemsep}{0pt}
          \setlength{\parsep}{0pt}
    \item 変更前画像と変更後画像の作成
    \item 画像比較による差分検出
    \item 結果の評価
\end{enumerate}

\section{レイアウトの不具合}\label{sec:layout effect}
レイアウトの不具合は、Webページの画面要素が適切にレイアウトされていないことである。【TODO: レイアウトの不具合検出に関する関連研究のリンクを見つける】
% レイアウトの不具合が発生すると、WebサイトやWebアプリの使いやすさを損ない、ユーザが必要な情報を見つけることが難しくなる。
本研究では、以下の主な3つのレイアウトの不具合を検出対象とする。
\begin{itemize}
    \setlength{\itemsep}{0pt}
          \setlength{\parsep}{0pt}
    \item 画面要素の隠れ
    \item 画面要素の見切れ
    \item 画面要素の重なり
\end{itemize}
画面要素の隠れは、Webページの特定の画面要素がその画面要素を含むコンテナやビューポートの境界を超えてはみ出している状態を指す。
画面要素の見切れは、Webページ上でコンテンツの一部がビューポートやコンテナ要素の境界によって切り取られ、完全には表示されない状態を指す。
画面要素の重なりは、Webページ上で複数の要素(テキスト、画像、ボタンなど)が意図せず重なってしまっている状態を指す。

\section{OpenCV}\label{sec:opencv}
OpenCV (Open Source Computer Vision Library)は、画像や動画に関する処理機能をまとめた、コンピュータビジョン向けのオープンソースのライブラリである\cite{OpenCV}。
本研究では、OpenCVに用意されている、imread関数、cvtColor関数、threshold関数、bitwise\_not関数、subtract関数の5つの関数を用いる。
\paragraph{imread関数}
imread関数は、画像ファイルの読み込みを行う関数である。
第一引数に、画像ファイルのパスを指定する。
\paragraph{cvtColor関数}
cvtColor関数は、画像の色空間を変換する関数である。
第一引数には、色空間変換を適用する画像を指定し、第二引数にはどの色空間へ変換するかを示すコードを指定する。
% 例えば、BGR(青、緑、赤)からGRAY(グレースケール)、RGB(赤、緑、青)からHSV(色相、彩度、明度)など、様々な色空間への変換が可能である。
本研究では、BGR(青、緑、赤)からGRAY(グレースケール)と、GRAY(グレースケール)からBGR(青、緑、赤)の色空間への変換に用いる。
\paragraph{adaptiveThreshold関数}
adaptiveThreshold関数は、画像の各小領域ごとに異なる閾値を用いて画像の二値化を行う関数である。
adaptiveThreshold関数を使用することで、画像の一部が明るく、別の部分が暗い場合においても、各部分に最適な閾値が自動で適用され、全体として均一な白黒画像を取得できる。
第一引数には、二値化を適用するグレースケール画像を指定し、第二引数には、ピクセル値の最大値($255$)を指定する。
第三引数には、局所的な二値化方法を指定し、本研究では、近傍領域の平均値に基づいて閾値を計算するcv2.ADAPTIVE\_THRESH\_MEAN\_Cを用いる。
第四引数には、二値化の方法を指定し、本研究では、閾値以下のピクセル値を最大値に変換し、
それ以外のピクセル値を$0$に変換する二値化方法であるcv2.THRESH\_BINARY\_INVを用いる。
第五引数には、近傍領域のサイズ、第六引数には計算された閾値から引かれる定数を指定する。
本研究では、近傍領域のサイズを$11$、計算された閾値から引かれる定数を$2$とする。
\paragraph{bitwise\_not関数}
bitwise\_not関数は、画像の各ピクセルのビットを反転する関数である。
ビット反転の例として、黒ピクセル（$0$の値を持つ）は白ピクセルに（$255$に）、白ピクセル（$255$の値を持つ）は黒ピクセルに（$0$に）反転する。
第一引数にビット反転を行う画像を指定する。
本研究では、二値化画像を指定して、画像の白黒を入れ替える際に用いる。
\paragraph{subtract関数}
subtract関数は、2つの画像間のピクセル値の差を計算する関数である。
第一引数と第二引数に指定した二つの画像の対応するピクセル値を減算し、結果を新しい画像として生成する。
なお、減算結果で負の値になった場合は、$0$として処理され、黒ピクセルとなる。
subtract関数を使用する例として、第一引数に二値化画像Aを、第二引数に二値化画像Bを指定すると、二値化画像Aのみにしかない部分(白ピクセル)を抽出した画像を生成できる。
本研究では、二値化処理を行った、Webページの変更前画像とWebページの変更後画像をそれぞれ交互に二回ずつ第一引数と第二引数に指定し、
変更前画像で削除された箇所を抽出した画像と、変更後画像で追加された箇所を抽出した画像を生成する。

\section{Pillow}\label{sec:pillow}
Pillow\cite{Pillow}は、Python\cite{Python}の画像処理ライブラリの一つで、画像の読み込み、処理、保存などの機能を提供する。
本研究では、Pillowに用意されている、Image.open関数、Image.LANCZOSを用いる。
\paragraph{Image.open関数}
Image.open関数は、指定したパスの画像ファイルを開き、PillowのImageオブジェクトとして返す。
このImageオブジェクトは、画像のサイズ変更、回転、色変換など、様々な画像処理を行うための基盤を提供する。
\paragraph{Image.LANCZOS}
Image.LANCZOSは、画像のリサイズに利用するフィルタの種類である。
LANCZOSフィルタは、高品質のリサンプリングフィルタであり、画像拡大時にも画質を維持するのに適している。

\paragraph{膨張処理}\label{sec:dilation}
膨張処理は、画像内の特定の領域を拡大する。
この処理は、画像の各ピクセルを中心として周囲のピクセルを考慮し、それらの最大値（通常は白ピクセル）を新しいピクセル値として適用する。
具体的には、画像上の小さな白い領域が拡大され、隣接する白い領域と連結しやすくなる。
この関数を適用する際には、第一引数に膨張を行いたい画像を指定し、カーネル（処理窓）のサイズと形状を定義する。
膨張処理は、画像処理において、特に二値化された画像の小さな白い領域を明確に見せる必要がある場合や、画像内の特定の特徴を強調する場合に用いられる。

\section{Selenium WebDriver}\label{sec:Selenium_WebDriver}
Selenium WebDriver\cite{Selenium WebDriver}は、Seleniumプロジェクト\cite{Selenium}の一部であり、Webブラウザを直接制御するためのAPIを提供する。
Selenium WebDriverのAPIを用いてテストスクリプトを実行することで、指定したWebページにアクセスし、要素のクリックやページ遷移などのユーザ操作を自動で行う。

\section{requestsモジュール}\label{sec:requests}

\section{difflibモジュール}\label{sec:difflib}

\section{Flask}\label{sec:Flask}